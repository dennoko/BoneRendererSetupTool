# Bone Renderer 自動セットアップ ツール — 使い方

このエディタ拡張は、選択したアバター（Humanoid）のルート GameObject に対して、Mecanim が認識するヒューマノイドボーンのみを抽出し、Animation Rigging の `BoneRenderer` に自動設定します。

## 前提条件
- Unity に Animation Rigging パッケージがインストールされていること（`BoneRenderer` が利用可能）
- 対象の GameObject に `Animator` が付いており、`Avatar` が Humanoid で有効であること
- 本スクリプトが `Editor` フォルダ内に入っていること

## 手順
1. ヒエラルキーで、アバターのルート GameObject（`Animator` + Humanoid `Avatar`）を選択します。
2. メニューから以下を実行します：
   - `Tools > Animation Rigging > Setup Bone Renderer for Humanoid`
3. 選択したオブジェクトに `BoneRenderer` が無い場合は自動で追加され、ヒューマノイドボーンの `Transform` が配列へ設定されます。
4. インスペクタで `BoneRenderer` を開き、`Transforms`（または `Bones`）にボーンが設定されていることを確認します。

## 補足
- 変換対象は `HumanBodyBones` の列挙に存在するボーン（`LastBone` を除く）のみです。補助ボーンや IK ターゲットなどは含まれません。
- 内部的には `Animator.GetBoneTransform(HumanBodyBones)` を利用しているため、ボーン名や階層に依存しません。
- バージョンによって、`BoneRenderer` の内部配列名が `m_Transforms` または `m_Bones` の場合があります。本ツールは両方に対応しています。
- 操作は Undo に記録され、シーンは自動的に Dirty マークされます。

## トラブルシューティング
- メニューがグレーアウトして実行できない：
  - 少なくとも 1 つ、`Animator` + Humanoid `Avatar` を持つ GameObject を選択しているか確認してください。
- 実行したが何も設定されない：
  - 対象の `Avatar` が Humanoid で有効（`isHuman` かつ `isValid`）か確認してください。
  - `Animation Rigging` パッケージがインストールされているか確認してください。
- 指定のボーンを除外したい：
  - スクリプトの収集処理（`CollectHumanoidTransforms`）で、不要な `HumanBodyBones` をフィルタする条件を追加してください。

## ライセンス
MIT ライセンス。詳細は `LICENCE` を参照してください。
